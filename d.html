############  FIRST CREATE AN MX AND AN A RECORD IN ARVANCLOUD THEN IN A NON ROOT USER:
sudo apt update;sudo apt upgrade
sudo hostnamectl set-hostname mail.zar-market.ir && sudo nano /etc/hosts
########### EDIT IT LIKE:
127.0.0.1       mail.zar-market.ir localhost
######### THEN LOGOUT AND LOGIN FOR THE CHANGES TO TAKE PLACE
wget https://github.com/iredmail/iRedMail/archive/1.4.0.tar.gz && tar xvf 1.4.0.tar.gz && cd iRedMail-1.4.0/
chmod +x iRedMail.sh && sudo bash iRedMail.sh
########### THEN SELECT REQUIRED OPTIONS LIKE: https://www.linuxbabe.com/mail-server/ubuntu-16-04-iredmail-server-installation
#/var/vmail => default
#nginx
#OpenLADP
#dc=zar-market,dc=ir
#199271Raiden
#zar-market.ir
#199271Raiden
#all except Sogo?
######################################################################################################################################
sudo shutdown -r now
#################### THEN HEAD TO https://mail.zar-market.ir/iredadmin/ AND CREATE A USER AND LOGIN IN https://mail.zar-market.ir/mail/
sudo apt install software-properties-common -y ; sudo add-apt-repository ppa:certbot/certbot
sudo apt update && sudo apt install certbot -y
sudo certbot certonly --webroot --agree-tos --email info@zar-market.ir -d mail.zar-market.ir -w /var/www/html/
sudo nano /etc/nginx/templates/ssl.tmpl
############## MAKE THESE CHANGES: ####################################################################
ssl_certificate /etc/ssl/certs/iRedMail.crt;
ssl_certificate_key /etc/ssl/private/iRedMail.key;

TO ++++++++++++

ssl_certificate /etc/letsencrypt/live/mail.zar-market.ir/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/mail.zar-market.ir/privkey.pem;
########################################################################################################
sudo systemctl reload nginx

sudo nano /etc/postfix/main.cf
############## MAKE THESE CHANGES:######################################################################
smtpd_tls_key_file = /etc/ssl/private/iRedMail.key
smtpd_tls_cert_file = /etc/ssl/certs/iRedMail.crt
smtpd_tls_CAfile = /etc/ssl/certs/iRedMail.crt
TO ++++++++++++
smtpd_tls_key_file = /etc/letsencrypt/live/mail.zar-market.ir/privkey.pem
smtpd_tls_cert_file = /etc/letsencrypt/live/mail.zar-market.ir/cert.pem
smtpd_tls_CAfile = /etc/letsencrypt/live/mail.zar-market.ir/chain.pem
##########################################################################################################
sudo postfix reload
sudo nano /etc/dovecot/dovecot.conf
############## MAKE THESE CHANGES:######################################################################
ssl_cert = </etc/ssl/certs/iRedMail.crt
ssl_key = </etc/ssl/private/iRedMail.key
TO ++++++++++++
ssl_cert = </etc/letsencrypt/live/mail.zar-market.ir/fullchain.pem
ssl_key = </etc/letsencrypt/live/mail.zar-market.ir/privkey.pem
##########################################################################################################
sudo dovecot reload

#then add a TXT record with onvan dkim._domainkey.zar-market.ir and value of
sudo amavisd-new showkeys
#inside paranteces whitout quotes and white spaces

rest of the conf ==> https://www.linuxbabe.com/mail-server/ubuntu-16-04-iredmail-server-installation
